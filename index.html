<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>HTML5 Localstorage Manager</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="extension/lib/bootstrap.min.css">
	<link rel="stylesheet" href="extension/localstorage.css">
	<style>
		body { padding:20px 10px; }
		.version { font-size:16px;font-weight:normal;font-style:italic; }
		.extension { font-family:'Open Sans',arial,sans-serif;font-size:18px;vertical-align:bottom; }
		.extension img { margin-right:10px; }
		.progress { margin-top:20px; }
		.progress .progress-bar { margin-right:5px; }
		.progress label { font-weight:normal;padding-left:5px;display:block; }
		.mt { margin-top:15px; }
		.feature { margin-top:30px;margin-bottom:30px; }
		.snapshot { list-style-type:none;width:100%;margin-top:10px;margin-bottom:50px; }
		.snapshot span { height:200px;overflow:hidden;border-bottom:3px solid #FFF; }
		.snapshot label { font-weight:normal;line-height:18px;color:#666;font-size:16px;margin-top:10px; }
		.jumbotron { background-image:url(images/forkme.png);background-position:right top;background-repeat:no-repeat;position:relative; }
		.jumbotron .github-fork { position:absolute;right:0;top:0;height:135px;width:135px; }
		.github-logo { background:transparent url(images/github.png) right 7px no-repeat scroll;background-size:16px;padding-right:22px; }
	</style>
	<script>
		try{
			localStorage.setItem('sample_data','Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborumLorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolora');
			localStorage.setItem('serialized_json','{"key":"value","object":{"level2nd":"deep"},"bool":true,"array":[1,2,3,{"another":"object"},"string"]}');
		}catch(e){}
	</script>
</head>
<body>
	<p id="not-support" class="text-center">
		Localstorage is not supported by your Browser.
	</p>
	<div class="jumbotron">
	  <div class="container-fluid">
		<div class="container">
			<span class="extension"><img src="images/extension.png" alt="" height="32" width="32" />Chrome Extension</span>
			<h1>HTML5 Localstorage Manager <span class="version">ver 1.5</span></h1>
			<ul class="feature">
				<li><p>Real-time inspect localstorage data of Chrome, any change of the localstorage made in current page will be shown immediately in this extension. </p></li>
				<li><p>Easily check / add / edit / remove localstorage, Also an independent popup window is provided so that developers can conveniently manage localstorage data while the current page is running.</p></li>
				<li><p>Parse and send JSON data to devtool console as object by clicking the <button class="btn btn-primary btn-xs">Dump JSON</button> button,it's much more readable for developers.</p></li>
				<li><p>Visualizable bar chart to indicate available localstorage size. And a simple cookie inspector is also provieded.</p></li>
			</ul>
		</div>
		<div class="snapshot row">
			<div class="col-sm-4">
				<span><img src="images/screenshot/icon.jpg" class="img-rounded img-responsive" /></span>
				<label>Orange icon in address bar to indicate whether the localstorage is used under current domain.</label>
			</div>
			<div class="col-sm-4">
				<span><img src="images/screenshot/localstorage.jpg" class="img-rounded img-responsive" /></span>
				<label>Manage localstorage easily via graphical user interface. JSON data can be dumped into console. </label>
			</div>
			<div class="col-sm-4">
				<span><img src="images/screenshot/popup.jpg" class="img-rounded img-responsive" /></span>
				<label>A popup window helps developer to inspect localstorage all the time.</label>
			</div>
			<!--<div class="col-sm-3">
				<span><img src="images/screenshot/cookie.jpg" class="img-rounded img-responsive" /></span>
				<label>Orange icon in address bar indicates whether the localstorage is used under current domain.</label>
			</div>-->
		</div>
		<p class="container">
			<a class="btn btn-primary btn-lg" href="https://chrome.google.com/webstore/detail/html5-localstorage-manage/giompennnhheakjcnobejbnjgbbkmdnd">Download in Chrome Web Store <img src="images/extension.png" alt="" height="32" width="32" /></a>
			<a class="btn btn-link github-logo" href="https://github.com/AndreLion/html5-localstorage-manager">View Source Code and Contribute on GitHub</a>
		</p>
	  </div>
	  <a href="https://github.com/AndreLion/html5-localstorage-manager" class="github-fork"></a>
	</div>
	<hr />
	<h2>Test Case</h2>
	<div class="form-group">
		<input id="key" class="form-control input-lg" type="text" placeholder="Key Name">
	</div>
	<button id="auto-key" type="button" class="btn btn-primary btn-lg">Auto Generate</button>
	<button id="reset-key" type="button" class="btn btn-warning btn-lg">Reset Key Name</button>
	<div class="form-group mt">
		<textarea id="value" class="form-control input-lg" rows="3" placeholder="Value"></textarea>
	</div>
	<button id="auto-value-1kb" type="button" class="btn btn-primary btn-lg">1Kb</button>
	<button id="auto-value-10kb" type="button" class="btn btn-primary btn-lg">10Kb</button>
	<button id="auto-value-100kb" type="button" class="btn btn-primary btn-lg">100Kb</button>
	<button id="auto-value-1mb" type="button" class="btn btn-primary btn-lg">1Mb</button>
	<button id="reset-value" type="button" class="btn btn-warning btn-lg">Reset Value</button>
	<button id="add" type="button" class="btn btn-success btn-lg">Add</button>
	<button id="clear" type="button" class="btn btn-danger btn-lg">Remove All</button>

	<div class="progress">
		<div class="progress-bar progress-bar-success" role="progressbar" id="space" aria-valuemin="0" aria-valuemax="100" style="width:0"></div>
		<label class="alert-success"><span id="available">90</span>% Available</label>
	</div>
	<div class="table-responsive">
		<table class="table table-condensed table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th width="20%">Key</th>
					<th width="70%">Value</th>
					<th class="text-center">Action</th>
				</tr>
			</thead>
			<tbody id="table-content">
				<tr class="nothing text-center">
					<td colspan="3">
						Nothing stored in localstorage under domain <span id="domain"></span>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	<hr />
	<h2 id="faq">FAQ</h2>
	<div class="panel panel-info">
		<div class="panel-heading">Q : The orange icon in the address bar is missing (sometimes).</div>
		<div class="panel-body">
			A : Make sure there is any localstorage data stored in current page, if not, the orange icon is hidden. Or, try to restart the chrome browser or reavtive the extension in the chrome extension manager center.
		</div>
	</div>
	<div class="panel panel-info">
		<div class="panel-heading">Q : The popup page of the extension is not working or the current page is redirected to somewhere else after clicked the icon under some certain website, such as <a href="http://stackoverflow.com/">stackoverflow.com</a> or <a href="https://twitter.com/">twitter.com</a>. </div>
		<div class="panel-body">
			A : Beacuse these websites prohibit 3rd part script from injecting iframes into their own website, so that the extension totally failed.
		</div>
	</div>
	<div class="panel panel-info">
		<div class="panel-heading">Q : The popup page of the extension get stuck when huge amount of data stored in the localstorage, what's the problem?</div>
		<div class="panel-body">
			A : The problem is Chrome browser can not deal with such amounts of DOM nodes in extension page, it's overloaded. Currently there is no solutions, even the Chrome Developer Tool get stuck too.
		</div>
	</div>
	<div class="panel panel-info">
		<div class="panel-heading">Q : Some javascript exceptions and 404 errors are thrown out into the console by the extension.</div>
		<div class="panel-body">
			A : Yes it happens, just leave them alone.
		</div>
	</div>
	<div class="panel panel-info">
		<div class="panel-heading">Q : Who made this extension?</div>
		<div class="panel-body">
			A : Please visit my <a href="http://andrelion.github.io/about/" target="blank">Github About Page</a> and <a href="http://lnkd.in/7tK6YX" target="blank">LinkedIn Profile</a>.
		</div>
	</div>
	<hr />
	<footer>
		<p>
			<span class="glyphicon glyphicon-hand-up"></span> If you find a bug or have suggestion, please <a href="https://github.com/AndreLion/html5-localstorage-manager/issues"><span class="glyphicon glyphicon-pencil"></span> write it down</a>.
		</p>
		<p>
			<span class="glyphicon glyphicon-thumbs-up"></span> If you like it, please tell another web developer or give us a rate.
			<a class="rate" href="https://chrome.google.com/webstore/detail/html5-localstorage-manage/giompennnhheakjcnobejbnjgbbkmdnd/reviews">
				<span class="glyphicon glyphicon-star-empty"></span>
				<span class="glyphicon glyphicon-star-empty"></span>
				<span class="glyphicon glyphicon-star-empty"></span>
				<span class="glyphicon glyphicon-star-empty"></span>
				<span class="glyphicon glyphicon-star-empty"></span>
			</a>
		</p>
		<!--<p>
			<span class="smily">â˜º</span> If this extension is helpful and saved you lots of time, please <a href="https://github.com/AndreLion/html5-localstorage-manager/issues"><span class="glyphicon glyphicon-usd"></span> donate</a> if you like.
		</p>-->
	</footer>
	<iframe src="notification-demo.html"></iframe>
	<script src="extension/lib/jquery-1.10.2.min.js"></script>
	<script src="extension/lib/cssua.min.js"></script>
	<script src="extension/localstorage.js"></script>
	<script>
window.onchange = function(ev){
	$('#table-content').removeClass('has-data').find('tr.something').remove();
	renderTable();
	renderSpace();

};
if(support()){
	$('#not-support').remove();
}else{
	$('body').addClass('not-support');
}

$('#auto-key').on('click',function(ev){
	$('#key').val('key_'+(+new Date)).select();
});
$('button[id|="auto-value"]').on('click',function(ev){
	var v = $('#value');
	switch(ev.target.id.split('-')[2]){
		case '1kb':
			v.val(longtext(1));
			break;
		case '10kb':
			v.val(longtext(10));
			break;
		case '100kb':
			v.val(longtext(100));
			break;
		case '1mb':
			v.val(longtext(1000));
			break;
	}
});
$('button[id|="reset"]').on('click',function(ev){
	$('#'+ev.target.id.split('-')[1]).val('');
});
$('#add').on('click',function(ev){
	var key = $('#key').val();
	var value = $('#value').val();
	$('#key').closest('div.form-group')[(key===''?'add':'remove')+'Class']('has-error');
	$('#value').closest('div.form-group')[(value===''?'add':'remove')+'Class']('has-error');
	if(key !== '' && value !== ''){
		setItem(key,value);
		$('#key,#value').val('');
	}
});
$('#clear').on('click',function(ev){
	store.clear();
});
$('#table-content').on('click','.more',function(ev){
	ev.preventDefault();
	$(this).closest('td').addClass('show-all');
});
$('#table-content').on('click','.remove',function(ev){
	var tr = $(ev.target).closest('tr');
	var key = tr.attr('key');
	store.removeItem(key);
});
$('#table-content').on('click','.edit',function(ev){
	var tr = $(ev.target).closest('tr');
	var edit = tr.addClass('updating').find('.value .content');
	edit.css('height',edit.height()+'px');
	edit.attr('contenteditable',true);
	selectElementContents(edit[0]);
});
$('#table-content').on('click','.confirm',function(ev){
	var tr = $(ev.target).closest('tr');
	var key = tr.attr('key');
	var value = tr.find('.value .content').text();
	tr.removeClass('updating');
	setItem(key,value);
});
$('#table-content').on('click','.cancel',function(ev){
	var tr = $(ev.target).closest('tr');
	var edit = tr.find('.value .content');
	edit.css('height','');
	edit.attr('contenteditable',false);
	tr.removeClass('updating');
	$(window).focus();
});
$('#table-content').on('click','.dump',function(ev){
	var tr = $(ev.target).closest('tr');
	var key = tr.attr('key');
	var value = tr.find('.value .content').text();
	console.log('HTML5 LocalStorage Manager dump JSON of key \''+key+'\' :');
	console.dir(JSON.parse(value));
});
$('.rate').on('mouseover','span',function(ev){
	$(this).add($(this).prevAll()).addClass('glyphicon-star').removeClass('glyphicon-star-empty');
});
$('.rate').on('mouseout','span',function(ev){
	$(this).add($(this).nextAll()).addClass('glyphicon-star-empty').removeClass('glyphicon-star');
});
renderTable();
renderSpace();
$('#domain').text(location.origin);
$('.snapshot').find('img').each(function(index,node){
	var n = $(node);
	n.attr('src',n.data('src'));
});
	</script>
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
</body>
</html>
